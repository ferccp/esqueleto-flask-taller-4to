{% extends "base.html" %}
{% from 'macros.html' import pintar_alerta %}

{% block titulo_pagina %} Proveedores {% endblock %}
{% block dinamico %}

<form action="" method="post" id="frm" >

  <div class="card">
    <div class="card-header">Proveedores</div>
    <div class="card-body">
        <!-- RUC y Identificador del RUC -->
        <div class="row g-3">
            <div class="col col-md-1">
                <label for="txtruc" class="visually-hidden">RUC</label>
            </div>
            <div class="col col-md-3">
              <input type="text" class="form-control" id="txtruc" name="txtruc" required>
            </div>
            <div class="col col-md-1">
                <label for="inputPassword2" class="visually-hidden">Identificador del RUC</label>
            </div>
            <div class="col col-md-1">
              <input type="text" class="form-control" id="txtid" name="txtid" autocomplete="off" required>
            </div>
        </div>
        <!--  -->
        <!-- razon social y direccion -->
        <div class="row g-3 pt-4">
           <div class="col col-md-1">
               <label for="txtruc" class="visually-hidden">Nombre o Razón Social</label>
           </div>
           <div class="col col-md-3">
             <input type="text" class="form-control" id="txtrazon" name="txtrazon" required >
           </div>
           <div class="col col-md-1">
               <label for="inputPassword2" class="visually-hidden">Dirección</label>
           </div>
           <div class="col col-md-4">
             <input type="text" class="form-control" id="txtdirección" name="txtdirección" autocomplete="off" required >
           </div>
        </div>
        <!--  -->
        <!-- Apellido y Email -->
        <div class="row g-3 pt-4">
            <div class="col col-md-1">
                <label for="txtapellido" class="visually-hidden" >Apellido</label>
            </div>
            <div class="col col-md-3">
              <input type="text" class="form-control" id="txtapellido" name="txtapellido" autocomplete="off" required>
            </div>
            <div class="col col-md-1">
                <label for="txtemail" class="visually-hidden">Email</label>
            </div>
            <div class="col col-md-3">
              <input type="text" class="form-control"  id="txtemail" name="txtemail" autocomplete="off" required>
            </div>
         </div>
         <!--  -->
         <!-- telefono -->
        <div class="row g-3 pt-4">
            <div class="col col-md-1">
                <label for="txttelefono" class="visually-hidden">Teléfono</label>
            </div>
            <div class="col col-md-3">
              <input type="text" class="form-control" id="txttelefono" name="txttelefono" autocomplete="off" required>
            </div>
        </div>
        <!--  -->
        <!-- pais y su combo -->
        <div class="row g-3 pt-4">
            <div class="col col-md-1">
                <label for="txtidpais" class="visually-hidden">País</label>
            </div>
            <div class="col col-md-3">
                <select class="form-control"  name = "selpais">
                        <option selected>...</option>
                        {% if lista_paises|length > 0%}
                                {% for pais in lista_paises %}
                                <option value="{{ pais['id'] }}">{{ pais['descripcion'] }}</option>
                                {% endfor %}
                        {% endif %}
                      </select>
            </div>
        </div>
        <!--  -->
        <!-- ciudad y su combo -->
        <div class="row g-3 pt-4">
            <div class="col col-md-1">
                <label for="txtidciudad" class="visually-hidden">Ciudad</label>
            </div>
            <div class="col col-md-3">
              <select class="form-control" name="selciudad"></select>
            </div>
             
        </div>
        <!--  -->
    </div>
    <div class="card-footer">
      <button type="submit" class="btn btn-primary" id="btnguardar">Guardar</button>
      <button type="button" class="btn btn-primary" id="btnlimpiar">Limpiar Formulario</button>

    </div>
  </div>
</form>
{{ pintar_alerta(messages) }}
{% endblock %}



{% block mi_javascript %}
<script>

const getCiudadesByPaisUrl = (id) => `/referencial/ciudad/get-ciudad-by-idpais/${id}`;
  const addEvents = () => {
    $('select[name="selpais"], select[name="selciudad"]').select2({
      placeholder: "...",
      theme: 'bootstrap-5'
    });
    $('select[name="selpais"').on('change', function(e) {
      const idpais = $(this).val();
      if(idpais) {
        $('select[name="selciudad"]').empty();
        $('select[name="selciudad"]').select2({
          placeholder: "...",
          theme: 'bootstrap-5',
          ajax: {
            url: getCiudadesByPaisUrl(idpais),
            dataType: 'json'
          }
        });
      }
    });
    $('#frm').on('submit', function(e){
      if(!validarFormulario()){
        e.preventDefault();
      }

    });
  }
 
 
 const validarFormulario = () => {

     const ruc = $('#txtruc').val();
     const identificador_ruc = $('#txtid').val();
     const razon = $('#txtrazon').val();
     const direccion = $('#txtdirección').val();
     const apellido = $('#txtapellido').val();
     const email = $('#txtemail').val();
     const telefono = $('#txttelefono').val();
     const idpais = $('select[name=selpais]').val();
     const idciudad = $('select[name=selciudad]').val();

    let arrayMensaje = [];

    if(!ruc) {
      arrayMensaje.push("El ruc no debe estar vacio")
    }
    if(!identificador_ruc) {
      arrayMensaje.push("El identificador_ruc no debe estar vacio")
    }
    if(!razon) {
      arrayMensaje.push("El razon no debe estar vacio")
    }
    if(!direccion) {
      arrayMensaje.push("El direccion no debe estar vacio")
    }
    if(!apellido) {
      arrayMensaje.push("El apellido no debe estar vacio")
    }
    if(!email) {
      arrayMensaje.push("El email no debe estar vacio")
    }
    if(!idpais) {
      arrayMensaje.push("El idpais no debe estar vacio")
    }
    if(!idciudad) {
      arrayMensaje.push("El idciudad no debe estar vacio")
    }
    if(arrayMensaje.length > 0){
      alert(arrayMensaje.join());
      return false;
    }
    return true;

 }
 
 
  //main function
  $(function(){
    addEvents();
  });

  </script>
{% endblock %}